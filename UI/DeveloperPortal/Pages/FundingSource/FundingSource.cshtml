@using DeveloperPortal.Domain.FundingSource
@model FundingSourcePageViewModel

<!-- Hidden fields -->
@Html.HiddenFor(m => m.CaseId)
@Html.HiddenFor(m => m.ControlViewModelId)

<table class="table table-striped" id="fundingSourceGrid">
    <thead>
        <tr>
            <th>Funding Source</th>
            <th>File Name</th>
            <th>Note</th>
            <th>MU (%)</th>
            <th>HV (%)</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @if (Model?.FundingSources != null)
        {
            @foreach (var item in Model.FundingSources)
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => item.FundingSource)</td>
                    <td>@Html.DisplayFor(modelItem => item.FileName)</td>
                    <td>@Html.DisplayFor(modelItem => item.Notes)</td>
                    <td>@Html.DisplayFor(modelItem => item.MU_Unit)</td>
                    <td>@Html.DisplayFor(modelItem => item.HV_Unit)</td>
                    <td>
                        <button type="button" class="btn btn-primary btn-sm edit-btn" data-id="@item.FundingSourceId">
                            <i class="fa fa-edit"></i> Edit
                        </button>
                        <button type="button" class="btn btn-danger btn-sm delete-btn" data-id="@item.FundingSourceId">
                            <i class="fa fa-trash"></i> Delete
                        </button>
                    </td>
                </tr>
            }
        }
    </tbody>
</table>

<div class="row">
    <div class="col-12 text-end mt-3">
        <button type="button" class="btn btn-primary" id="uploadFundingSourceBtn">
            Upload Funding Source
        </button>
    </div>
</div>



<div class="modal fade" id="editFundingSourceModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
            </div>
        </div>
    </div>
</div>

<script>


       $('#fundingSourceGrid' ).DataTable({
        processing: true,
        paging: true,
        pageLength: 10,
        "searching": true,
        "ordering": true,
        "LengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]]

    });


    // Delegated event handler to ensure the click event is always registered
    $(document).on('click', '.edit-btn', function() {
        var id = $(this).data('id');

        var url = APPURL + "FundingSource/Edit?ID = " + id;

         AjaxCommunication.CreateRequest(this.window, "GET", url, "html", null,
            function (result) {
                debugger;
               $('#editFundingSourceModal .modal-body').html(result);
                $('#editFundingSourceModal').modal('show');
            }, null, true, null, false);


        // if (id !== undefined) {
        //     // Correct AJAX URL for a standard MVC controller
        //     $.get('/FundingSource/Edit/' + id, function(data) {
        //         $('#editFundingSourceModal .modal-body').html(data);
        //         $('#editFundingSourceModal').modal('show');
        //     }).fail(function(jqXHR, textStatus, errorThrown) {
        //         console.error('AJAX request failed:', textStatus, errorThrown);
        //     });
        // }
    });

    // The Delete button click handler
    $(document).on('click', '.delete-btn', function() {
        var id = $(this).data('id');
        if (confirm('Are you sure you want to delete this record?')) {
            $.post('/FundingSource/Delete/' + id, function(response) {
                if (response.success) {
                    location.reload();
                } else {
                    alert('Error deleting the record.');
                }
            });
        }
    });
</script>