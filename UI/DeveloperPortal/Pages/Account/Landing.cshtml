@page "/"
@model DeveloperPortal.Pages.Account.SignUpModel


<header class="landing-banner">
    <div>
        <h1>Welcome to the AcHP Construction/ Retrofit Third-Party Portal</h1>
        <p>This is your one stop shop for uploading and receiving property files</p>
    </div>
</header>

<form id="landing-signin">
    <h2>Sign In to Your Account</h2>

    <div class="landing-signin-field">
        <label for="email" class="sr-only">Email Address</label>
        <input id="email" name="email" type="email" 
            placeholder="Email Address" required autocomplete="email">
    </div>

    <div class="landing-signin-field">
        <label for="password" class="sr-only">Password</label>
        <input id="password" name="password" type="password" 
            placeholder="Password" required autocomplete="new-password">
    </div>
    <input type="hidden" name="appKey" id="appKey" value="ThirdPartyPortalAppKey">
    <input type="hidden" name="refURL" id="refURL" value="">

    <div class="landing-signin-row">
        <div class="landing-signin-field">
            <label style="display: inline-flex; align-items: center; white-space: nowrap; font-size: 15px;">
                <input id="rememberMe" name="rememberMe" type="checkbox" style="margin-right: 6px;">
                Remember Me
            </label>
        </div>
        <p class="forgot-password"><a href="#">Forgot Your Password?</a></p>
    </div>

    <div class="landing-signup-actions">
        <button type="submit" class="landing-signin-button" id="btnSignIn">Sign In</button>
    </div>
    <div class="landing-signup-actions">
        <button type="button" class="landing-signin-button" id="btnAngelenoSignIn">Sign In With Angelo</button>
    </div>

    <p class="divider">Or</p>
    
    <div class="landing-signup-actions">
        <button type="submit" class="landing-signup-button" id="btnSignUp">Sign Up</button>
    </div>
    
    <div id="loginError" style="color: red; margin-top: 1em;"></div>
</form>


<script>
    // SIGN IN POST
    document.getElementById("landing-signin").addEventListener("submit", async function(evt) {
        evt.preventDefault();

        const payload = {
          Username:   document.getElementById("email").value.trim(),
          Password:   document.getElementById("password").value,
          RememberMe: document.getElementById("rememberMe").checked
        };

        try {
          const response = await fetch("/Login/LoginSql", {
            method:  "POST",
            headers: { "Content-Type": "application/json" },
            body:    JSON.stringify(payload)
          });

          // if server doesn't return JSON
          const contentType = response.headers.get("content-type") || "";
          console.log("Content-Type:", contentType);
          if (!contentType.includes("application/json")) {
            document.getElementById("loginError").innerText = `Unexpected server response (${response.status})`;
            return;
          }

          const json = await response.json();

          if (json.success) {
            window.location.href = json.redirectUrl; // direct to dashboard
          } else {
            document.getElementById("loginError").innerText = json.message;
          }
        } catch (error) {
          console.error("LoginSql request failed:", error);
          document.getElementById("loginError").innerText
            = "Unexpected error. Please try again later.";
        }
    });

    // ANGELO SIGN IN 
    document.getElementById('btnAngelenoSignIn').addEventListener('click', function () {
        window.location.href = '/Login/AngelenoLogin';
    });

    // SIGN UP
    document.getElementById('btnSignUp').onclick = function() {
    window.location.href = 'Account/SignUp';
    };
</script>


