@page
@model DeveloperPortal.Pages.PlanReview.IndexModel
@{
}
<style>
    .table-responsive .row {
        margin-bottom: 15px;
    }

    .datatbl {
        width: 100% !important;
    }
</style>
<link rel="stylesheet" href="https://cdn.rawgit.com/enyo/dropzone/master/dist/dropzone.css">
<script src="https://cdn.rawgit.com/enyo/dropzone/master/dist/dropzone.js"></script>

<div class="row custom_row_margin">

    <div id="workFlowDiv" class="col-md-12 position-relative">
        <h1 class="fs-title">Plan Review</h1>
        <div class="page-title left-data" id="divCollapseAll">
            <ul class="quick-action-link noprint">
                <li id="CollapseAll" class="mr-2">
                    <button type="button" class="btn btn-primary " onclick="CollapseAll()">
                        <span height="20" width="20" id="CollapseIn">Hide All Sections<span class="fas fa-chevron-up"></span></span>
                        <span height="20" width="20" style="display: none;" id="CollapseOut">Show All Sections<span class="fas fa-chevron-down"></span></span>
                    </button>
                </li>
                <li class="back-to-search-btn-container mr-2" style="padding-right: 1em; display: none;">
                    <a href="/AAHR.UI/ComCon/Tab/RenderTab?tabName=Search%20for%20Accessible%20Housing&amp;IsSearchFilterApplied=True" class="btn btn-primary back-to-search" style="width: 13em;padding: 7px 6px 6px 0px;">
                        <span height="20" width="20" id="back-to-search"><span class="fas fa-arrow-left" style="padding-right: 0.3em;"></span>Back to search page</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>

</div>
<div class="page-header-box">
    <div class="row">
        <div class="col-6">
            <h2 style="color:#135B79">Plan Review - Serenity Apt</h2>
        </div>
        <div class="col-6 text-right ">
            <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addFolderModal">Add Plan Review Folder </button>
        </div>
    </div>
</div>

<div class="page-content">
    <div class="accordion" id="accfolder">

        @for (int index = 0; index < Model.FolderModel.Folders.Count; index++)
        {
            var accId = "accheader" + index;
            var folderView = "gidfolderView" + index;
            var collapseId = "divgridfolderView" + index;
            var tblFiles = "tblFiles" + index;

            var showcss = index == 0 ? "show" : "";
            var planReviewFolder = Model.FolderModel.Folders[index];
            <div class="row GridviewViewRow">
                <div class="col-sm-12">
                    <gridv>
                        <div class="card penal-details backgroundwhite dataTable-changes" id="@accId">
                            <h2 class="card-header accordion-header">
                                <button type="button" class="card-header-title m-0" id="@folderView">
                                    @planReviewFolder.Name
                                </button>
                            </h2>
                            <div class="card-body table-content" id="@collapseId" style="position: relative;">
                                <div class="row m-0">
                                    <div class="col-12 text-right">
                                        <div class="btn-group" role="group" aria-label="Button group with nested dropdown">

                                            <div class="btn-group" role="group">
                                                <button id="btnGroupDrop1" type="button" class="btn btn-primary" data-bs-toggle="dropdown" aria-expanded="false">
                                                    <span class="glyphicon glyphicon-nav" aria-hidden="true"></span>
                                                </button>
                                                <ul class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                                    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#addNoteModal">  Add Note</a></li>
                                                    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#addFileModal"> Upload File</a></li>
                                                    <li><a class="dropdown-item" href="#">Edit Folder</a></li>
                                                    <li><a class="dropdown-item" href="# ">Send Email</a></li>

                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row m-0">
                                    <div class="col-12">
                                        <h5><a class="" href="#">Files</a></h5>
                                    </div>
                                    <div class="col-12">
                                        <div class="table-responsive">

                                            <table tabindex="0" id="@tblFiles" class="datatbl table table-bordered dataTable no-footer" border="1">
                                                <thead class="thead-light">
                                                    <tr role="row">
                                                        <th scope="col" class="sorting" aria-controls="tblFiles" rowspan="1" colspan="1" style="width: 263px;" role="columnheader" aria-sort="none">
                                                            Share with NAC   <button type="button" class="btn-th noprint" aria-label="Name. Unsorted. Sort ascending.">↕</button>
                                                        </th>
                                                        <th scope="col" class="sorting" aria-controls="tblFiles" rowspan="1" colspan="1" style="width: 263px;" role="columnheader" aria-sort="none">
                                                            Date  <button type="button" class="btn-th noprint" aria-label="Name. Unsorted. Sort ascending.">↕</button>
                                                        </th>
                                                        <th scope="col" class="sorting" aria-controls="tblFiles" rowspan="1" colspan="1" style="width: 263px;" role="columnheader" aria-sort="none">
                                                            Filename  <button type="button" class="btn-th noprint" aria-label="Name. Unsorted. Sort ascending.">↕</button>
                                                        </th>
                                                        <th scope="col" class="sorting" aria-controls="tblFiles" rowspan="1" colspan="1" style="width: 263px;" role="columnheader" aria-sort="none">
                                                            Category  <button type="button" class="btn-th noprint" aria-label="Name. Unsorted. Sort ascending.">↕</button>
                                                        </th>
                                                        <th scope="col" class="sorting" aria-controls="tblFiles" rowspan="1" colspan="1" style="width: 263px;" role="columnheader" aria-sort="none">
                                                            Uploaded By  <button type="button" class="btn-th noprint" aria-label="Name. Unsorted. Sort ascending.">↕</button>
                                                        </th>
                                                    </tr>
                                                </thead>

                                            </table>

                                        </div>

                                    </div>

                                </div>
                                <div class="row m-0">

                                    <div class="col-12 text-right ">
                                        <button type="button" class="btn btn-sm btn-primary">Approve</button> &nbsp; &nbsp;
                                        <button type="button" class="btn btn-sm btn-primary">Not approve </button>
                                    </div>
                                </div>
                                <br />
                                <div class="row m-0">
                                    <div class="col-12">
                                        <h5>   <a class="" href="#">Notes</a></h5>
                                    </div>
                                    <div class="col-12">
                                        <table id="tblNotes" class="table table-striped" style="width:100%">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Name</th>
                                                    <th>Note	 </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @*  @foreach (var planReviewNote in planReviewFolder.Notes)
                                            {
                                            <tr>

                                            <td>@planReviewNote.UploadedDate</td>
                                            <td>@planReviewNote.Name</td>
                                            <td>@planReviewNote.Note</td>
                                            </tr>
                                            }*@

                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </gridv>
                </div>
            </div>
            <br />
        }




        @*@for (int index = 0; index < Model.PlanReviewFolders.Count; index++)
        {
        var accId = "accheader" + index;
        var collapseId = "collapse" + index;
        var showcss = index == 0 ? "show" : "";
        var planReviewFolder = Model.PlanReviewFolders[index];
        <div class="accordion-item">

        <h2 class="accordion-header" id="@accId">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target='@("#" + collapseId)' aria-expanded="false" aria-controls="@collapseId">
        @planReviewFolder.Name
        </button>
        </h2>
        <div id="@collapseId" class='@("accordion-collapse collapse " +showcss )' aria-labelledby="@accId" data-bs-parent="#accfolder">
        <div class="accordion-body">
        <div class="row">
        <div class="col-12 text-right">
        <div class="btn-group" role="group" aria-label="Button group with nested dropdown">

        <div class="btn-group" role="group">
        <button id="btnGroupDrop1" type="button" class="btn btn-primary" data-bs-toggle="dropdown" aria-expanded="false">
        <span class="glyphicon glyphicon-nav" aria-hidden="true"></span>
        </button>
        <ul class="dropdown-menu" aria-labelledby="btnGroupDrop1">
        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#addNoteModal">  Add Note</a></li>
        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#addFileModal"> Upload File</a></li>
        <li><a class="dropdown-item" href="#">Edit Folder</a></li>
        <li><a class="dropdown-item" href="# ">Send Email</a></li>

        </ul>
        </div>
        </div>
        </div>
        </div>

        <div class="row">
        <div class="col-12">
        <a class="" href="#">Files</a>
        </div>
        <div class="col-12">
        <table id="tblFiles" class="table table-striped" style="width:100%">
        <thead>
        <tr>
        <th>Share with NAC	</th>
        <th>Date</th>
        <th>Filename</th>
        <th>Category	 </th>
        <th>Uploaded By</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var planReviewFile in planReviewFolder.Files)
        {
        <tr>
        <td>
        <input checked="@planReviewFile.ShareWithNAC"
        id="isActive"
        name="isActive"
        type="checkbox"
        value="@planReviewFile.ShareWithNAC" />


        </td>
        <td>@planReviewFile.UploadedDate</td>
        <td>@planReviewFile.Name</td>
        <td>@planReviewFile.FilePath</td>
        <td>@planReviewFile.UploadedBy</td>
        </tr>
        }

        </tbody>
        </table>
        </div>

        </div>
        <div class="row">

        <div class="col-12 text-right ">
        <button type="button" class="btn btn-sm btn-primary">Approve</button> &nbsp; &nbsp;
        <button type="button" class="btn btn-sm btn-primary">Not approve </button>
        </div>
        </div>
        <br />

        <div class="row">
        <div class="col-12">
        <a class="" href="#">Notes</a>
        </div>
        <div class="col-12">
        <table id="tblNotes" class="table table-striped" style="width:100%">
        <thead>
        <tr>
        <th>Date</th>
        <th>Name</th>
        <th>Note	 </th>
        </tr>
        </thead>
        <tbody>
        @foreach (var planReviewNote in planReviewFolder.Notes)
        {
        <tr>

        <td>@planReviewNote.UploadedDate</td>
        <td>@planReviewNote.Name</td>
        <td>@planReviewNote.Note</td>
        </tr>
        }

        </tbody>
        </table>
        </div>

        </div>
        </div>
        </div>
        </div>
        }*@

    </div>

</div>

@* Start modal popup*@
<div class="modal fade" id="addFolderModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Create Folder</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">X</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="exampleFormControlTextarea1">Folder Name</label>
                    <input type="text" class="form-control" id="txtfolderName"></input>
                </div>
            </div>
            <div class="modal-footer multi-button comcom-fotter">
                <button type="button" class="btn btn-Cancel" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="createFolder" class="btn btn-primary">Create Folder</button>

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addNoteModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Note</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">X</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="exampleFormControlTextarea1">Note*</label>
                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" style="width:100%; height:120px"></textarea>
                </div>
            </div>
            <div class="modal-footer multi-button comcom-fotter">
                <button type="button" class="btn btn-Cancel" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Update</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addFileModal" tabindex="-1" aria-labelledby="AddFileModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="AddFileModalLabel">Upload File</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">X</button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="exampleFormControlInput1">Received Date*</label>
                        <input type="date" class="form-control" id="receivedDate" placeholder="dd/mm/yyyy">
                    </div>
                    <div class="form-group">
                        <label for="exampleFormControlSelect1">Category* </label>
                        <select class="form-control" id="category">
                            <option>Category 1</option>
                            <option>Category 2</option>
                            <option>Category 3</option>
                            <option>Category 4</option>
                            <option>Category 5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="exampleFormControlSelect2">Status*</label>
                        <select class="form-control" id="status">
                            <option>Status 1</option>
                            <option>Status 2</option>
                            <option>Status 3</option>
                            <option>Status 4</option>
                            <option>Status 5</option>
                        </select>
                    </div>

                </form>
                <br />
                <div class="form-group">
                    <form action="" class="dropzone dz-clickable" id="upload-File">
                        <div >
                            <input type="file" id="fileuploader" class="dz-message d-flex flex-column" class="file-styled" />
                           @* <span style="font-size:38px;"> Drop files to upload</span>
                            (or click)*@
                        </div>
                        

                    </form>
                </div>

            </div>
            <div class="modal-footer multi-button comcom-fotter AddDocumentfotter">
                <button id="cancelUpload" type="button" value="" class="btn btn-Cancel" data-bs-dismiss="modal">Cancel</button>
                <button id="uploadFile" type="button" value="" class="btn btn-primary">Upload</button>
            </div>
        </div>
    </div>
</div>
@* end modal popup*@
<script>
    $(document).ready(function () {

        $("#createFolder").click(function () {
            var url = "/api/PlanReview/CreateFolder?folderName=" + $("#txtfolderName").val() + "&parentFolderName=ARLT Arleta Park";
            $.ajax({
                url: url, success: function (result) {
                    $("#div1").html(result);
                }
            });
        });
        
        $("#uploadFile").click(function () {

            var input = document.getElementById('upload-File');
            
            var files = $("#fileuploader").get(0).files;
            var formData = new FormData();
            formData.append("files", files[0]);
            formData.append("folderName", $("#txtfolderName").val());
            var url = "/api/PlanReview/UploadFile";
            $.ajax(
                {
                    url: url,
                    data: formData,
                    processData: false,
                    contentType: false,
                    type: "POST",
                    success: function (data) {
                        alert("Files Uploaded!");
                    }
                }
            );



        //    //$.ajax({
        //    //    url: url, success: function (result) {
        //    //        
        //    //        $("#div1").html(result);
        //    //    }
        //    //});
        });

        var model = @Html.Raw(Json.Serialize(Model.FolderModel));
        model.folders.forEach(function (forderview, index) {
            var folderView = "#gidfolderView" + index;
            var collapseId = "#divgridfolderView" + index;
            var tblFiles = "tblFiles" + index;
            var isCollapsed = index !== 0;
            accrodianSlideToggle(folderView, collapseId, isCollapsed);
            PopulateData(tblFiles, forderview.files)
        });
    });

    function PopulateData(tableName, data) {
        $('#' + tableName).DataTable({
            data: data,
            sorting: false,
            searching: true,
            paging: true,
            info: false,
            header: false,
            columns: [
                { data: 'shareWithNAC' },
                { data: 'uploadedDate' },
                { data: 'name' },
                { data: 'link' },
                { data: 'uploadedBy' }
            ]
        });
    }
</script>