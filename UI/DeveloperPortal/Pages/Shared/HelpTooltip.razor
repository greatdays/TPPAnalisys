@using Microsoft.JSInterop
@* HelpTooltip.razor *@
<span class="d-inline-block"
      tabindex="0"
      data-bs-toggle="tooltip"
      data-bs-placement="@Placement"
      data-bs-html="true"
      title="@HelpText"
      @ref="tooltipElement"
      role="button"
      aria-label="Help information: @GetPlainText()">
    <i class="fas fa-question-circle"
       style="font-size: @Size; cursor: pointer; color: white;"
       aria-hidden="true"></i>
</span>

@code {
    [Parameter]
    public string HelpText { get; set; } = "Help information";

    [Parameter]
    public string Placement { get; set; } = "top"; // top, bottom, left, right, auto

    [Parameter]
    public string Size { get; set; } = "1.2rem";

    private ElementReference tooltipElement;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("initializeTooltip", tooltipElement);
        }
    }

    private string GetPlainText()
    {
        // Strip HTML tags for aria-label
        return System.Text.RegularExpressions.Regex.Replace(HelpText, "<.*?>", string.Empty);
    }

    [Inject]
    private IJSRuntime JSRuntime { get; set; } = default!;
}